{"ast":null,"code":"import _regeneratorRuntime from\"/Users/xuyanjun/workspace/vision/airdrop_protocol/airdrop_interface/node_modules/babel-preset-react-app/node_modules/@babel/runtime/regenerator\";import _asyncToGenerator from\"/Users/xuyanjun/workspace/vision/airdrop_protocol/airdrop_interface/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";import _slicedToArray from\"/Users/xuyanjun/workspace/vision/airdrop_protocol/airdrop_interface/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/slicedToArray\";import{Pair,Token}from'@uniswap/sdk';import flatMap from'lodash.flatmap';import{useCallback,useMemo}from'react';import{shallowEqual,useDispatch,useSelector}from'react-redux';import{BASES_TO_TRACK_LIQUIDITY_FOR,PINNED_PAIRS,UserRoleMode}from'../../constants';import{useActiveWeb3React}from'../../hooks';import{useAllTokens}from'../../hooks/Tokens';import{addSerializedPair,addSerializedToken,removeSerializedToken,updateUserDarkMode,updateUserDeadline,updateUserExpertMode,updateUserSlippageTolerance,updateUserRoleMode}from'./actions';import{airdropV2,airdropV2Swap,getUserNonce}from'./api';import{useUserModeInputCurrency}from'../swap/hooks';function serializeToken(token){return{chainId:token.chainId,address:token.address,decimals:token.decimals,symbol:token.symbol,name:token.name};}function deserializeToken(serializedToken){return new Token(serializedToken.chainId,serializedToken.address,serializedToken.decimals,serializedToken.symbol,serializedToken.name);}export function useIsDarkMode(){var _useSelector=useSelector(function(_ref){var _ref$user=_ref.user,matchesDarkMode=_ref$user.matchesDarkMode,userDarkMode=_ref$user.userDarkMode;return{userDarkMode:userDarkMode,matchesDarkMode:matchesDarkMode};},shallowEqual),userDarkMode=_useSelector.userDarkMode,matchesDarkMode=_useSelector.matchesDarkMode;return userDarkMode===null?matchesDarkMode:userDarkMode;}export function useIsRoleProjectMode(){var roleMode=useSelector(function(state){return state.user.userRoleMode;});return useMemo(function(){return roleMode===UserRoleMode.PROJECT;},[roleMode]);}export function useUserRoleMode(){var dispatch=useDispatch();var _useUserModeInputCurr=useUserModeInputCurrency(),handleReplaceSwapState=_useUserModeInputCurr.handleReplaceSwapState;var isProjectMode=useIsRoleProjectMode();var toggleSetUserRoleMode=useCallback(function(){dispatch(updateUserRoleMode({userRoleMode:isProjectMode?UserRoleMode.USER:UserRoleMode.PROJECT}));handleReplaceSwapState(!isProjectMode);},[isProjectMode,dispatch,handleReplaceSwapState]);return[isProjectMode,toggleSetUserRoleMode];}export function useDarkModeManager(){var dispatch=useDispatch();var darkMode=useIsDarkMode();var toggleSetDarkMode=useCallback(function(){dispatch(updateUserDarkMode({userDarkMode:!darkMode}));},[darkMode,dispatch]);return[darkMode,toggleSetDarkMode];}export function useIsExpertMode(){return useSelector(function(state){return state.user.userExpertMode;});}export function useExpertModeManager(){var dispatch=useDispatch();var expertMode=useIsExpertMode();var toggleSetExpertMode=useCallback(function(){dispatch(updateUserExpertMode({userExpertMode:!expertMode}));},[expertMode,dispatch]);return[expertMode,toggleSetExpertMode];}export function useUserSlippageTolerance(){var dispatch=useDispatch();var userSlippageTolerance=useSelector(function(state){return state.user.userSlippageTolerance;});var setUserSlippageTolerance=useCallback(function(userSlippageTolerance){dispatch(updateUserSlippageTolerance({userSlippageTolerance:userSlippageTolerance}));},[dispatch]);return[userSlippageTolerance,setUserSlippageTolerance];}export function useUserDeadline(){var dispatch=useDispatch();var userDeadline=useSelector(function(state){return state.user.userDeadline;});var setUserDeadline=useCallback(function(userDeadline){dispatch(updateUserDeadline({userDeadline:userDeadline}));},[dispatch]);return[userDeadline,setUserDeadline];}export function useAddUserToken(){var dispatch=useDispatch();return useCallback(function(token){dispatch(addSerializedToken({serializedToken:serializeToken(token)}));},[dispatch]);}export function useRemoveUserAddedToken(){var dispatch=useDispatch();return useCallback(function(chainId,address){dispatch(removeSerializedToken({chainId:chainId,address:address}));},[dispatch]);}export function useUserAddedTokens(){var _useActiveWeb3React=useActiveWeb3React(),chainId=_useActiveWeb3React.chainId;var serializedTokensMap=useSelector(function(_ref2){var tokens=_ref2.user.tokens;return tokens;});return useMemo(function(){var _serializedTokensMap;if(!chainId)return[];return Object.values((_serializedTokensMap=serializedTokensMap[chainId])!==null&&_serializedTokensMap!==void 0?_serializedTokensMap:{}).map(deserializeToken);},[serializedTokensMap,chainId]);}function serializePair(pair){return{token0:serializeToken(pair.token0),token1:serializeToken(pair.token1)};}export function usePairAdder(){var dispatch=useDispatch();return useCallback(function(pair){dispatch(addSerializedPair({serializedPair:serializePair(pair)}));},[dispatch]);}/**\n * Given two tokens return the liquidity token that represents its liquidity shares\n * @param tokenA one of the two tokens\n * @param tokenB the other token\n */export function toV2LiquidityToken(_ref3){var _ref4=_slicedToArray(_ref3,2),tokenA=_ref4[0],tokenB=_ref4[1];return new Token(tokenA.chainId,Pair.getAddress(tokenA,tokenB),18,'UNI-V2','Uniswap V2');}/**\n * Returns all the pairs of tokens that are tracked by the user for the current chain ID.\n */export function useTrackedTokenPairs(){var _useActiveWeb3React2=useActiveWeb3React(),chainId=_useActiveWeb3React2.chainId;var tokens=useAllTokens();// pinned pairs\nvar pinnedPairs=useMemo(function(){var _PINNED_PAIRS$chainId;return chainId?(_PINNED_PAIRS$chainId=PINNED_PAIRS[chainId])!==null&&_PINNED_PAIRS$chainId!==void 0?_PINNED_PAIRS$chainId:[]:[];},[chainId]);// pairs for every token against every base\nvar generatedPairs=useMemo(function(){return chainId?flatMap(Object.keys(tokens),function(tokenAddress){var _BASES_TO_TRACK_LIQUI;var token=tokens[tokenAddress];// for each token on the current chain,\nreturn(// loop though all bases on the current chain\n((_BASES_TO_TRACK_LIQUI=BASES_TO_TRACK_LIQUIDITY_FOR[chainId])!==null&&_BASES_TO_TRACK_LIQUI!==void 0?_BASES_TO_TRACK_LIQUI:[]).// to construct pairs of the given token with each base\nmap(function(base){if(base.address===token.address){return null;}else{return[base,token];}}).filter(function(p){return p!==null;}));}):[];},[tokens,chainId]);// pairs saved by users\nvar savedSerializedPairs=useSelector(function(_ref5){var pairs=_ref5.user.pairs;return pairs;});var userPairs=useMemo(function(){if(!chainId||!savedSerializedPairs)return[];var forChain=savedSerializedPairs[chainId];if(!forChain)return[];return Object.keys(forChain).map(function(pairId){return[deserializeToken(forChain[pairId].token0),deserializeToken(forChain[pairId].token1)];});},[savedSerializedPairs,chainId]);var combinedList=useMemo(function(){return userPairs.concat(generatedPairs).concat(pinnedPairs);},[generatedPairs,pinnedPairs,userPairs]);return useMemo(function(){// dedupes pairs of tokens in the combined list\nvar keyed=combinedList.reduce(function(memo,_ref6){var _ref7=_slicedToArray(_ref6,2),tokenA=_ref7[0],tokenB=_ref7[1];var sorted=tokenA.sortsBefore(tokenB);var key=sorted?\"\".concat(tokenA.address,\":\").concat(tokenB.address):\"\".concat(tokenB.address,\":\").concat(tokenA.address);if(memo[key])return memo;memo[key]=sorted?[tokenA,tokenB]:[tokenB,tokenA];return memo;},{});return Object.keys(keyed).map(function(key){return keyed[key];});},[combinedList]);}export function useAirdrop(){var _useActiveWeb3React3=useActiveWeb3React(),account=_useActiveWeb3React3.account;var handleAirdrop=useCallback(/*#__PURE__*/function(){var _ref8=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(algToken,totalAmount){var res,msg,sign,airdropRes;return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:if(!account){_context.next=13;break;}_context.next=3;return getUserNonce(account);case 3:res=_context.sent;if(!(res.code===0)){_context.next=13;break;}msg=\"0x\".concat(Buffer.from(res.data.nonce,'utf8').toString('hex'));// @ts-ignore\n_context.next=8;return window.ethereum.request({method:'personal_sign',params:[msg,account,'Inferer']});case 8:sign=_context.sent;_context.next=11;return airdropV2(account,sign,totalAmount+'000000000000000000',algToken);case 11:airdropRes=_context.sent;console.log(airdropRes);case 13:case\"end\":return _context.stop();}}},_callee);}));return function(_x,_x2){return _ref8.apply(this,arguments);};}(),[account,getUserNonce]);var handleAirdropSwap=useCallback(/*#__PURE__*/function(){var _ref9=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee2(algTokenAddress,airTokenAddress){var res,msg,sign,amount,swpRes;return _regeneratorRuntime.wrap(function _callee2$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:if(!account){_context2.next=14;break;}_context2.next=3;return getUserNonce(account);case 3:res=_context2.sent;if(!(res.code===0)){_context2.next=14;break;}msg=\"0x\".concat(Buffer.from(res.data.nonce,'utf8').toString('hex'));// @ts-ignore\n_context2.next=8;return window.ethereum.request({method:'personal_sign',params:[msg,account,'Inferer']});case 8:sign=_context2.sent;amount='28248587570621468900';_context2.next=12;return airdropV2Swap(account,sign,[account],[amount],algTokenAddress,airTokenAddress);case 12:swpRes=_context2.sent;console.log(swpRes);case 14:case\"end\":return _context2.stop();}}},_callee2);}));return function(_x3,_x4){return _ref9.apply(this,arguments);};}(),[account,getUserNonce]);return{handleAirdrop:handleAirdrop,handleAirdropSwap:handleAirdropSwap};}","map":{"version":3,"sources":["/Users/xuyanjun/workspace/vision/airdrop_protocol/airdrop_interface/src/state/user/hooks.tsx"],"names":["Pair","Token","flatMap","useCallback","useMemo","shallowEqual","useDispatch","useSelector","BASES_TO_TRACK_LIQUIDITY_FOR","PINNED_PAIRS","UserRoleMode","useActiveWeb3React","useAllTokens","addSerializedPair","addSerializedToken","removeSerializedToken","updateUserDarkMode","updateUserDeadline","updateUserExpertMode","updateUserSlippageTolerance","updateUserRoleMode","airdropV2","airdropV2Swap","getUserNonce","useUserModeInputCurrency","serializeToken","token","chainId","address","decimals","symbol","name","deserializeToken","serializedToken","useIsDarkMode","user","matchesDarkMode","userDarkMode","useIsRoleProjectMode","roleMode","state","userRoleMode","PROJECT","useUserRoleMode","dispatch","handleReplaceSwapState","isProjectMode","toggleSetUserRoleMode","USER","useDarkModeManager","darkMode","toggleSetDarkMode","useIsExpertMode","userExpertMode","useExpertModeManager","expertMode","toggleSetExpertMode","useUserSlippageTolerance","userSlippageTolerance","setUserSlippageTolerance","useUserDeadline","userDeadline","setUserDeadline","useAddUserToken","useRemoveUserAddedToken","useUserAddedTokens","serializedTokensMap","tokens","Object","values","map","serializePair","pair","token0","token1","usePairAdder","serializedPair","toV2LiquidityToken","tokenA","tokenB","getAddress","useTrackedTokenPairs","pinnedPairs","generatedPairs","keys","tokenAddress","base","filter","p","savedSerializedPairs","pairs","userPairs","forChain","pairId","combinedList","concat","keyed","reduce","memo","sorted","sortsBefore","key","useAirdrop","account","handleAirdrop","algToken","totalAmount","res","code","msg","Buffer","from","data","nonce","toString","window","ethereum","request","method","params","sign","airdropRes","console","log","handleAirdropSwap","algTokenAddress","airTokenAddress","amount","swpRes"],"mappings":"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","sourcesContent":["import { ChainId, Pair, Token } from '@uniswap/sdk'\nimport flatMap from 'lodash.flatmap'\nimport { useCallback, useMemo } from 'react'\nimport { shallowEqual, useDispatch, useSelector } from 'react-redux'\nimport { BASES_TO_TRACK_LIQUIDITY_FOR, PINNED_PAIRS, UserRoleMode } from '../../constants'\n\nimport { useActiveWeb3React } from '../../hooks'\nimport { useAllTokens } from '../../hooks/Tokens'\nimport { AppDispatch, AppState } from '../index'\nimport {\n  addSerializedPair,\n  addSerializedToken,\n  removeSerializedToken,\n  SerializedPair,\n  SerializedToken,\n  updateUserDarkMode,\n  updateUserDeadline,\n  updateUserExpertMode,\n  updateUserSlippageTolerance,\n  updateUserRoleMode\n} from './actions'\nimport { airdropV2, airdropV2Swap, getUserNonce } from './api'\nimport { useUserModeInputCurrency } from '../swap/hooks'\n\nfunction serializeToken(token: Token): SerializedToken {\n  return {\n    chainId: token.chainId,\n    address: token.address,\n    decimals: token.decimals,\n    symbol: token.symbol,\n    name: token.name\n  }\n}\n\nfunction deserializeToken(serializedToken: SerializedToken): Token {\n  return new Token(\n    serializedToken.chainId,\n    serializedToken.address,\n    serializedToken.decimals,\n    serializedToken.symbol,\n    serializedToken.name\n  )\n}\n\nexport function useIsDarkMode(): boolean {\n  const { userDarkMode, matchesDarkMode } = useSelector<\n    AppState,\n    { userDarkMode: boolean | null; matchesDarkMode: boolean }\n  >(\n    ({ user: { matchesDarkMode, userDarkMode } }) => ({\n      userDarkMode,\n      matchesDarkMode\n    }),\n    shallowEqual\n  )\n\n  return userDarkMode === null ? matchesDarkMode : userDarkMode\n}\n\nexport function useIsRoleProjectMode(): boolean {\n  const roleMode = useSelector<AppState, AppState['user']['userRoleMode']>(state => state.user.userRoleMode)\n  return useMemo(() => roleMode === UserRoleMode.PROJECT , [roleMode])\n}\n\nexport function useUserRoleMode(): [boolean, () => void] {\n  const dispatch = useDispatch<AppDispatch>()\n  const { handleReplaceSwapState } = useUserModeInputCurrency()\n\n  const isProjectMode = useIsRoleProjectMode()\n\n  const toggleSetUserRoleMode = useCallback(() => {\n    dispatch(updateUserRoleMode({ userRoleMode: isProjectMode ? UserRoleMode.USER : UserRoleMode.PROJECT }))\n    handleReplaceSwapState(!isProjectMode)\n  }, [isProjectMode, dispatch, handleReplaceSwapState])\n\n  return [isProjectMode, toggleSetUserRoleMode]\n}\n\nexport function useDarkModeManager(): [boolean, () => void] {\n  const dispatch = useDispatch<AppDispatch>()\n  const darkMode = useIsDarkMode()\n\n  const toggleSetDarkMode = useCallback(() => {\n    dispatch(updateUserDarkMode({ userDarkMode: !darkMode }))\n  }, [darkMode, dispatch])\n\n  return [darkMode, toggleSetDarkMode]\n}\n\nexport function useIsExpertMode(): boolean {\n  return useSelector<AppState, AppState['user']['userExpertMode']>(state => state.user.userExpertMode)\n}\n\nexport function useExpertModeManager(): [boolean, () => void] {\n  const dispatch = useDispatch<AppDispatch>()\n  const expertMode = useIsExpertMode()\n\n  const toggleSetExpertMode = useCallback(() => {\n    dispatch(updateUserExpertMode({ userExpertMode: !expertMode }))\n  }, [expertMode, dispatch])\n\n  return [expertMode, toggleSetExpertMode]\n}\n\nexport function useUserSlippageTolerance(): [number, (slippage: number) => void] {\n  const dispatch = useDispatch<AppDispatch>()\n  const userSlippageTolerance = useSelector<AppState, AppState['user']['userSlippageTolerance']>(state => {\n    return state.user.userSlippageTolerance\n  })\n\n  const setUserSlippageTolerance = useCallback(\n    (userSlippageTolerance: number) => {\n      dispatch(updateUserSlippageTolerance({ userSlippageTolerance }))\n    },\n    [dispatch]\n  )\n\n  return [userSlippageTolerance, setUserSlippageTolerance]\n}\n\nexport function useUserDeadline(): [number, (slippage: number) => void] {\n  const dispatch = useDispatch<AppDispatch>()\n  const userDeadline = useSelector<AppState, AppState['user']['userDeadline']>(state => {\n    return state.user.userDeadline\n  })\n\n  const setUserDeadline = useCallback(\n    (userDeadline: number) => {\n      dispatch(updateUserDeadline({ userDeadline }))\n    },\n    [dispatch]\n  )\n\n  return [userDeadline, setUserDeadline]\n}\n\nexport function useAddUserToken(): (token: Token) => void {\n  const dispatch = useDispatch<AppDispatch>()\n  return useCallback(\n    (token: Token) => {\n      dispatch(addSerializedToken({ serializedToken: serializeToken(token) }))\n    },\n    [dispatch]\n  )\n}\n\nexport function useRemoveUserAddedToken(): (chainId: number, address: string) => void {\n  const dispatch = useDispatch<AppDispatch>()\n  return useCallback(\n    (chainId: number, address: string) => {\n      dispatch(removeSerializedToken({ chainId, address }))\n    },\n    [dispatch]\n  )\n}\n\nexport function useUserAddedTokens(): Token[] {\n  const { chainId } = useActiveWeb3React()\n  const serializedTokensMap = useSelector<AppState, AppState['user']['tokens']>(({ user: { tokens } }) => tokens)\n  return useMemo(() => {\n    if (!chainId) return []\n    return Object.values(serializedTokensMap[chainId as ChainId] ?? {}).map(deserializeToken)\n  }, [serializedTokensMap, chainId])\n}\n\nfunction serializePair(pair: Pair): SerializedPair {\n  return {\n    token0: serializeToken(pair.token0),\n    token1: serializeToken(pair.token1)\n  }\n}\n\nexport function usePairAdder(): (pair: Pair) => void {\n  const dispatch = useDispatch<AppDispatch>()\n\n  return useCallback(\n    (pair: Pair) => {\n      dispatch(addSerializedPair({ serializedPair: serializePair(pair) }))\n    },\n    [dispatch]\n  )\n}\n\n/**\n * Given two tokens return the liquidity token that represents its liquidity shares\n * @param tokenA one of the two tokens\n * @param tokenB the other token\n */\nexport function toV2LiquidityToken([tokenA, tokenB]: [Token, Token]): Token {\n  return new Token(tokenA.chainId, Pair.getAddress(tokenA, tokenB), 18, 'UNI-V2', 'Uniswap V2')\n}\n\n/**\n * Returns all the pairs of tokens that are tracked by the user for the current chain ID.\n */\nexport function useTrackedTokenPairs(): [Token, Token][] {\n  const { chainId } = useActiveWeb3React()\n  const tokens = useAllTokens()\n\n  // pinned pairs\n  const pinnedPairs = useMemo(() => (chainId ? PINNED_PAIRS[chainId] ?? [] : []), [chainId])\n\n  // pairs for every token against every base\n  const generatedPairs: [Token, Token][] = useMemo(\n    () =>\n      chainId\n        ? flatMap(Object.keys(tokens), tokenAddress => {\n            const token = tokens[tokenAddress]\n            // for each token on the current chain,\n            return (\n              // loop though all bases on the current chain\n              (BASES_TO_TRACK_LIQUIDITY_FOR[chainId] ?? [])\n                // to construct pairs of the given token with each base\n                .map(base => {\n                  if (base.address === token.address) {\n                    return null\n                  } else {\n                    return [base, token]\n                  }\n                })\n                .filter((p): p is [Token, Token] => p !== null)\n            )\n          })\n        : [],\n    [tokens, chainId]\n  )\n\n  // pairs saved by users\n  const savedSerializedPairs = useSelector<AppState, AppState['user']['pairs']>(({ user: { pairs } }) => pairs)\n\n  const userPairs: [Token, Token][] = useMemo(() => {\n    if (!chainId || !savedSerializedPairs) return []\n    const forChain = savedSerializedPairs[chainId]\n    if (!forChain) return []\n\n    return Object.keys(forChain).map(pairId => {\n      return [deserializeToken(forChain[pairId].token0), deserializeToken(forChain[pairId].token1)]\n    })\n  }, [savedSerializedPairs, chainId])\n\n  const combinedList = useMemo(() => userPairs.concat(generatedPairs).concat(pinnedPairs), [\n    generatedPairs,\n    pinnedPairs,\n    userPairs\n  ])\n\n  return useMemo(() => {\n    // dedupes pairs of tokens in the combined list\n    const keyed = combinedList.reduce<{ [key: string]: [Token, Token] }>((memo, [tokenA, tokenB]) => {\n      const sorted = tokenA.sortsBefore(tokenB)\n      const key = sorted ? `${tokenA.address}:${tokenB.address}` : `${tokenB.address}:${tokenA.address}`\n      if (memo[key]) return memo\n      memo[key] = sorted ? [tokenA, tokenB] : [tokenB, tokenA]\n      return memo\n    }, {})\n\n    return Object.keys(keyed).map(key => keyed[key])\n  }, [combinedList])\n}\n\nexport function useAirdrop() {\n  const { account } = useActiveWeb3React() \n  const handleAirdrop = useCallback(async (algToken, totalAmount) => {\n        // return\n    if (account) {\n      \n      const res = await getUserNonce(account)\n      \n      if (res.code === 0) {\n        const msg = `0x${Buffer.from(res.data.nonce, 'utf8').toString('hex')}`;\n        // @ts-ignore\n        const sign = await window.ethereum.request({\n          method: 'personal_sign',\n          params: [msg, account, 'Inferer'],\n        });\n        // const totalAmount = '1000000000000000000000'\n        \n        const airdropRes = await airdropV2(account, sign, totalAmount + '000000000000000000', algToken);\n        console.log(airdropRes)\n\n      }\n    }\n    \n  }, [\n    account,\n    getUserNonce,\n\n  ])\n  const handleAirdropSwap = useCallback(async (algTokenAddress, airTokenAddress) => {\n    if (account) {\n      const res = await getUserNonce(account)\n      \n      if (res.code === 0) {\n        const msg = `0x${Buffer.from(res.data.nonce, 'utf8').toString('hex')}`;\n        // @ts-ignore\n        const sign = await window.ethereum.request({\n          method: 'personal_sign',\n          params: [msg, account, 'Inferer'],\n        });\n        const amount = '28248587570621468900'\n        const swpRes = await airdropV2Swap(account, sign, [account], [amount], algTokenAddress, airTokenAddress);\n        console.log(swpRes)\n\n      }\n    }\n    \n  }, [\n    account,\n    getUserNonce,\n\n  ])\n\n  return {\n    handleAirdrop,\n    handleAirdropSwap\n  }\n  \n}\n"]},"metadata":{},"sourceType":"module"}